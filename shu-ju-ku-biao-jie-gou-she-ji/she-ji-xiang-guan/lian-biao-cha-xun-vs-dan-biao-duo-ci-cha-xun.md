---
description: 使用join去执行一条sql联表查好还是单表执行多个sql去查更好
---

# 联表查询vs单表多次查询

### 1. 效率

多表使用join关联查询效率高还是多次单表查询效率高？

例如：A、B两个表数据规模十几万，数据规模都不大，单机MySQL已经完全足够了，在单机的基础上要关联两表的数据，假如A、B两个表都没有索引，并且关联是笛卡尔积，那关联结果会爆炸式增长，可能到亿级别，这个时候网络IO成了瓶颈，这个时候两次十万行结果集的拉取可能远小于1次亿级别的结果集的拉取，那么将关联合并拉到代码的service层做会更快。

### 2. 优先在代码层面做计算

单机数据库计算资源紧缺，数据库同时要服务写和读，都需要消耗CPU，为了能让数据库的吞吐变得更高，而业务又不在乎那几百微妙到毫秒级的延时差距，业务会把更多计算放到service层做。所以大多数业务会把纯计算操作放到service层做。

### 3. 分库分表无法join

对于一些数据库由于数据规模庞大，不得不对数据库进行分库分表，对于分库分表的应用，使用join也受到了很多限制，除非业务能够很好的根据route key明确要join的两个表在同一个物理库中。而中间件一般对跨库join都支持不好。（即使现在的表没有分库分表，那么如果以后进行分库分表的话，**代码需要做很大的变动，**否则很可能无法运行）

### 4. 单表查简单

多次单表查询更加简单，逻辑更清楚一些，不用写很复杂的sql，出错的概率也会小一些。

{% hint style="success" %}
下面是一个例子：
{% endhint %}

关联查询VS多次单表查询，举例如：

```sql
select * from UserLogin_
inner join User_ on UserLogin_.userId=User_.userId
where userName='xxx';
```

转化成单表：

```sql
select * from User_ where userName='xxx';
select * from UserLogin_ where userId in (第一条语句的结果);
```



