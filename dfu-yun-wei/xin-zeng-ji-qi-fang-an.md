# 新增机器方案

在遇到大量用户加入应用或者遇到某个时间段使用人数较多时，常常需要增加机器来承受高QPS，下面总结大致的增加机器跑服务的方法：

（1）购买机器。在云服务商那里购买机器，理论上Win和Linux机器都可以，建议Linux系统，购买完成后在安全组配置里开启必要的端口。

（2）安装Java（1.8）、filebeat等必要软件，增加Java的环境变量，安装完成之后应该具有下面三个应用，desire\_fu\_api\_jar-1.0是后端服务，filebeat-6.4.3-linux-x86\_64用于上报日志到ES，jdk1.8是Java。这三个都可以直接从其他已经可以成功跑起来的机器上打成压缩包直接上传解压。

![](../.gitbook/assets/image%20%2870%29.png)

（3）配置环境。服务运行环境配置文件，启动脚本执行时，首先会判断当前运行环境，并传参给服务，服务根据传参决定加载哪一个配置文件，由bin/getenv.sh脚本获取环境变量。所以如果是生产环境，需要在/data/release下新建一个env\_prod文件。完成以后就可以执行bin/start.sh启动服务了。

（4）配置nginx。服务启动了之后，还无法直接参与处理请求，因为请求都是达到nginx的，我们需要在nginx的配置里增加新增的机器的配置，导入流量：

![](../.gitbook/assets/image%20%28110%29.png)







